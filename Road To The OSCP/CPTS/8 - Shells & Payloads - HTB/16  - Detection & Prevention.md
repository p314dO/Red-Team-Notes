Cuando se trata de buscar e identificar proyectiles activos, entrega y ejecución de carga útil y posibles intentos de subvertir nuestras defensas, tenemos muchas opciones diferentes que podemos utilizar para detectar y responder a estos eventos. Antes de hablar sobre las fuentes de datos y las herramientas que podemos usar, tomemos un segundo para hablar sobre el [marco MITRE ATT&CK](https://attack.mitre.org/) y definir las técnicas y tácticas que utilizan los atacantes. El `ATT&CK Framework` tal como lo define MITRE, es " `a globally-accessible knowledge base of adversary tactics and techniques based on real-world observations`".

Teniendo en cuenta el marco, tres de las técnicas más notables que podemos vincular a Shells y cargas útiles se enumeran a continuación en la tabla con descripciones.

#### Tácticas y técnicas notables de MITRE ATT&CK:

| **Táctica / Técnica**                                        | **Descripción**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Acceso inicial](https://attack.mitre.org/techniques/T1190/) | Los atacantes intentarán obtener acceso inicial comprometiendo un host o servicio público, como aplicaciones web, servicios mal configurados como SMB o protocolos de autenticación, y/o errores en un host público que introducen una vulnerabilidad. Esto a menudo se hace en algún tipo de host bastión y proporciona al atacante un punto de apoyo en la red, pero aún no acceso completo. Para obtener más información sobre el acceso inicial, especialmente a través de aplicaciones web, consulte el [Top Ten de OWASP](https://owasp.org/www-project-top-ten/) o lea más en el marco de Mitre Att&ck.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [Ejecución](https://attack.mitre.org/tactics/TA0002)         | Esta técnica depende del código proporcionado e instalado por un atacante que se ejecuta en el host de la víctima. `The Shells & Payloads`El módulo se centra principalmente en esta táctica. Utilizamos muchas cargas útiles, métodos de entrega y soluciones de secuencias de comandos de shell diferentes para acceder a un host. Esto puede ser cualquier cosa, desde la ejecución de comandos dentro de nuestro navegador web para obtener la ejecución y el acceso a una aplicación web, emitir una línea de PowerShell a través de PsExec, aprovechar un exploit publicado públicamente o el día cero junto con un marco como Metasploit, o cargar un archivo a un host a través de muchos protocolos diferentes y llamarlo de forma remota para recibir una devolución de llamada.                                                                                                                                                                                                                                                                          |
| [Comando y control](https://attack.mitre.org/tactics/TA0011) | Comando y control ( `C2`) puede considerarse como la culminación de nuestros esfuerzos dentro de este módulo. Obtenemos acceso a un host y establecemos algún mecanismo para el acceso continuo y/o interactivo mediante la ejecución de código, luego utilizamos ese acceso para realizar acciones de seguimiento sobre objetivos dentro de la red de la víctima. Es común el uso de puertos y protocolos estándar dentro de la red de la víctima para emitir comandos y recibir resultados de la víctima. Esto puede aparecer como cualquier cosa, desde tráfico web normal a través de HTTP/S, comandos emitidos a través de otros protocolos externos comunes como DNS y NTP, e incluso el uso de aplicaciones permitidas comunes como Slack, Discord o MS Teams para emitir comandos y recibir cheques. -En s. C2 puede tener varios niveles de sofisticación, que van desde canales básicos de texto claro como Netcat hasta el uso de protocolos cifrados y ofuscados junto con rutas de tráfico complejas a través de servidores proxy, redirectores y VPN. |
## Eventos a tener en cuenta:

- `File uploads`: Especialmente con aplicaciones web, la carga de archivos es un método común para adquirir un shell en un host además de la ejecución directa de comandos en el navegador. Preste atención a los registros de la aplicación para determinar si alguien ha subido algo potencialmente malicioso. El uso de firewalls y antivirus puede agregar más capas a su postura de seguridad en el sitio. Cualquier host expuesto a Internet desde su red debe estar suficientemente reforzado y monitoreado.
- `Suspicious non-admin user actions`: Buscar cosas simples como usuarios normales emitiendo comandos a través de Bash o cmd puede ser un indicador importante de compromiso. ¿Cuándo fue la última vez que un usuario promedio, y mucho menos un administrador, tuvo que emitir el comando? `whoami`en un anfitrión? Los usuarios que se conectan a un recurso compartido en otro host de la red a través de SMB que no es un recurso compartido de infraestructura normal también pueden resultar sospechosos. Este tipo de interacción suele ser de host final a servidor de infraestructura, no de host final a host final. Habilitar medidas de seguridad como el registro de todas las interacciones del usuario, el registro de PowerShell y otras características que toman nota cuando se utiliza una interfaz de shell le brindará más información.
- `Anomalous network sessions`: Los usuarios tienden a tener un patrón que siguen para la interacción en la red. Visitan los mismos sitios web, utilizan las mismas aplicaciones y, a menudo, realizan esas acciones varias veces al día como un reloj. Registrar y analizar datos de NetFlow puede ser una excelente manera de detectar tráfico de red anómalo. Observar cosas como los principales conversadores o visitas únicas al sitio, observar un latido en un puerto no estándar (como 4444, el puerto predeterminado utilizado por Meterpreter) y monitorear cualquier intento de inicio de sesión remoto o solicitudes masivas de GET/POST en cortos períodos de tiempo. Todos pueden ser indicadores de compromiso o intento de explotación. El uso de herramientas como monitores de red, registros de firewall y SIEMS puede ayudar a poner un poco de orden en el caos que es el tráfico de la red.

